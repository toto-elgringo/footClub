{% extends 'layouts/base.twig' %}

{% block title %}Update joueur - Foot Club{% endblock %}

{% block stylesheets %}
    <link rel="stylesheet" href="../css/joueurs.css">
{% endblock %}

{% block content %}
    <div class="container update-container">
        <div class="header">
            <div class="page-title">
                <div>
                    <h1>Update joueur {{ player.getFirstname() }} {{ player.getLastname() }}</h1>
                    <p>Mettez à jour les informations du joueur</p>
                </div>
            </div>
        </div>

        <form method="post" enctype="multipart/form-data" class="update-form-container">
            <input type="hidden" name="old_firstname" value="{{ player.getFirstname() }}">
            <input type="hidden" name="old_lastname" value="{{ player.getLastname() }}">

            <label for="prenom">Prénom</label>
            <input type="text" id="prenom" name="prenom" value="{{ player.getFirstname() }}" required>

            <label for="nom">Nom</label>
            <input type="text" id="nom" name="nom" value="{{ player.getLastname() }}" required>

            <label for="birthdate">Date de naissance</label>
            <input type="date" id="birthdate" name="birthdate" value="{{ player.getBirthdate().format('Y-m-d') }}" required>

            <label for="picture">Photo (laisser vide pour conserver l'actuelle)</label>
            <input type="file" id="picture" name="picture">

            <div class="current-photo">
                <img src="../uploads/{{ player.getPicture() }}" alt="Photo actuelle">
            </div>

            <button type="submit" name="update_player" value="1">Enregistrer</button>
            <a href="joueurs.php" class="cancel">Annuler</a>
        </form>

        <div class="teams-section">
            <h2>Équipes du joueur</h2>

            {% if playerTeams is not empty %}
                <div class="appartient-equipe">
                    {% for relation in playerTeams %}
                        <div class="equipe-bubble">
                            <span class="delete-team">✕</span>
                            <form method="post" action="joueursUpdate.php?firstname={{ player.getFirstname() }}&lastname={{ player.getLastname() }}" class="delete-team-form" style="display:none;">
                                <input type="hidden" name="action" value="remove_from_team">
                                <input type="hidden" name="team_name" value="{{ relation.getTeam().getName() }}">
                            </form>
                            <span class="equipe-info">
                                {{ relation.getTeam().getName() }}
                                -
                                {{ relation.getRole().value }}
                            </span>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <p>Ce joueur n'appartient à aucune équipe.</p>
            {% endif %}

            <div class="ajouter-equipe">
                <h3>Ajouter à une équipe</h3>
                <form action="joueursUpdate.php?firstname={{ player.getFirstname() }}&lastname={{ player.getLastname() }}" method="post">
                    <input type="hidden" name="action" value="add_to_team">
                    <select name="team_name" required>
                        <option value="">Sélectionner une équipe</option>
                        {% for team in availableTeams %}
                            <option value="{{ team.getName() }}">{{ team.getName() }}</option>
                        {% endfor %}
                    </select>
                    <select name="role" required>
                        <option value="">Sélectionner un rôle</option>
                        <option value="Gardien">Gardien</option>
                        <option value="Défenseur">Défenseur</option>
                        <option value="Milieu">Milieu</option>
                        <option value="Attaquant">Attaquant</option>
                    </select>
                    <button type="submit" class="submit-button">Ajouter</button>
                </form>
            </div>
        </div>
    </div>
{% endblock %}

{% block scripts %}
    <script src="../js/joueursUpdate.js"></script>
{% endblock %}
